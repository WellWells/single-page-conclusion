<!doctypehtml><html lang="zh-Hant"class="scroll-smooth"><meta name="twitter:image"content="https://wellstsai.com/single-page-conclusion/%E8%A8%98%E6%86%B6%E9%AB%94%E5%AE%8C%E6%95%B4%E6%80%A7%E5%BC%B7%E5%88%B6%E5%9F%B7%E8%A1%8C.png"><meta name="twitter:description"content="掌握 Apple 記憶體安全新戰略：MIE 整合 EMTE 與安全配置器，針對溢位與釋放後使用提供硬體級檢查，效能影響極小，並說明部署策略。"><meta name="twitter:title"content="記憶體完整性強制執行"><meta name="twitter:card"content="summary_large_image"><meta property="og:type"content="article"><meta property="og:site_name"content="WellWells"><meta property="og:image"content="https://wellstsai.com/single-page-conclusion/%E8%A8%98%E6%86%B6%E9%AB%94%E5%AE%8C%E6%95%B4%E6%80%A7%E5%BC%B7%E5%88%B6%E5%9F%B7%E8%A1%8C.png"><meta property="og:url"content="https://wellstsai.com/single-page-conclusion/%E8%A8%98%E6%86%B6%E9%AB%94%E5%AE%8C%E6%95%B4%E6%80%A7%E5%BC%B7%E5%88%B6%E5%9F%B7%E8%A1%8C.html"><meta property="og:description"content="掌握 Apple 記憶體安全新戰略：MIE 整合 EMTE 與安全配置器，針對溢位與釋放後使用提供硬體級檢查，效能影響極小，並說明部署策略。"><meta property="og:title"content="記憶體完整性強制執行"><meta name="description"content="掌握 Apple 記憶體安全新戰略：MIE 整合 EMTE 與安全配置器，針對溢位與釋放後使用提供硬體級檢查，效能影響極小，並說明部署策略。"><meta charset="utf-8"><meta name="viewport"content="width=device-width,initial-scale=1"><title>記憶體完整性強制執行（MIE）｜Apple 裝置記憶體安全的完整願景</title><meta name="color-scheme"content="light dark"><script src="https://cdn.tailwindcss.com"></script><script>tailwind.config={darkMode:"class",theme:{extend:{colors:{brand:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"}},boxShadow:{soft:"0 1px 2px rgb(0 0 0 / 0.04), 0 4px 12px rgb(0 0 0 / 0.06)"}}}}</script><style>#progressBar::before{content:"";position:absolute;inset:0;width:var(--scroll,0%);background:linear-gradient(to right,#60a5fa,#22d3ee)}.toc-link[aria-current=true]{color:rgb(37 99 235);font-weight:600}mark.search-hit{background:#fde68a;padding:.1rem .2rem;border-radius:.2rem}.anchor-offset{scroll-margin-top:6.5rem}.keyword{position:relative;cursor:pointer;border-radius:.25rem;padding:0 .125rem;background:0 0;border:none;font:inherit;color:inherit;text-align:left;--underline-color-from:#60a5fa;--underline-color-to:#22d3ee}.keyword::after{content:'';position:absolute;left:0;bottom:-2px;width:100%;height:2px;background:linear-gradient(to right,var(--underline-color-from),var(--underline-color-to));transform:scaleX(0);transform-origin:left center;transition:transform 250ms ease-out}.keyword:focus-visible::after,.keyword:hover::after{transform:scaleX(1)}.keyword:focus-visible{outline:2px solid var(--underline-color-from);outline-offset:2px}.keyword:focus:not(:focus-visible){outline:0}@media (prefers-reduced-motion:reduce){.keyword::after{transition:none}.keyword:focus-visible::after,.keyword:hover::after{transform:scaleX(1)}}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-JKC4KZLT26"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JKC4KZLT26")</script><body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-200 transition-colors duration-300"><div id="progressBar"class="fixed top-0 left-0 right-0 h-1 z-50 bg-slate-200/60 dark:bg-slate-700/60 overflow-hidden"></div><header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/90 dark:bg-slate-900/80 border-b border-slate-200/70 dark:border-slate-700/50 transition-colors duration-300"><div class="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3"><a href="#top"class="inline-flex items-center gap-2 font-semibold text-slate-900 dark:text-white"><svg width="24"height="24"viewBox="0 0 24 24"class="opacity-80"><path fill="currentColor"d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2m1 5v6h5v2h-7V7z"/></svg> MIE：記憶體完整性強制執行</a><div class="ms-auto flex items-center gap-2"><label class="sr-only"for="searchInput">全文搜尋</label> <input id="searchInput"type="search"placeholder="搜尋關鍵字（Enter）"class="hidden md:block rounded-lg border border-slate-300 dark:border-slate-600 bg-white/70 dark:bg-slate-800/70 px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-brand-400 w-64"> <button id="clearSearch"class="hidden md:inline-flex text-sm px-2 py-1 rounded border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800">清除</button> <button id="themeToggle"class="inline-flex items-center gap-1 rounded-lg border border-slate-300 dark:border-slate-600 px-3 py-1.5 text-sm hover:bg-slate-100 dark:hover:bg-slate-800"aria-label="切換深色/淺色"><svg id="iconSun"class="h-5 w-5 hidden"viewBox="0 0 24 24"><path fill="currentColor"d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.8l1.8-1.8m10.48 0l1.79-1.79l1.79 1.79l-1.79 1.8l-1.79-1.8M12 4c-.55 0-1 .45-1 1v2a1 1 0 0 0 2 0V5c0-.55-.45-1-1-1m7 7c0-.55-.45-1-1-1h-2a1 1 0 0 0 0 2h2c.55 0 1-.45 1-1M12 17a5 5 0 1 1 0-10a5 5 0 0 1 0 10m-1 2v2a1 1 0 0 0 2 0v-2a1 1 0 0 0-2 0M4 11H2a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2m1.76 8.16l-1.8 1.8l1.79 1.79l1.8-1.79l-1.79-1.8m12.48 0l1.8 1.8l1.79-1.8l-1.79-1.79l-1.8 1.79Z"/></svg> <svg id="iconMoon"class="h-5 w-5 hidden"viewBox="0 0 24 24"><path fill="currentColor"d="M12.74 2a1 1 0 0 0-.98 1.22A9 9 0 1 0 20.78 12a1 1 0 0 0 1.22-.98A11 11 0 0 1 12.74 2Z"/></svg> <span class="hidden sm:inline">主題</span></button></div></div></header><main id="top"class="mx-auto max-w-7xl px-4 pt-8 pb-20"><div class="grid grid-cols-1 lg:grid-cols-[18rem,1fr] gap-8"><aside class="lg:block hidden"><div class="sticky top-[5.5rem]"><div class="mb-3 text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">本頁章節</div><nav id="toc"class="space-y-1 text-sm"></nav><div class="mt-6 p-3 rounded-lg bg-slate-100/70 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700"><div class="text-xs text-slate-500 dark:text-slate-400">技巧</div><ul class="mt-1 list-disc ms-5 text-sm leading-6"><li>按章節標題右側「#」可複製連結<li>上方搜尋支援<span class="px-1 rounded bg-yellow-100 text-yellow-800">高亮</span></ul></div></div></aside><article id="article"class="min-w-0"><section class="mb-8"><h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white anchor-offset"data-toc>記憶體完整性強制執行：Apple 裝置記憶體安全的完整願景</h1><div class="mt-3 flex flex-wrap items-center gap-2 text-sm text-slate-600 dark:text-slate-300"><span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">部落格</span> <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">2025 年 9 月 9 日</span> <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">Apple 安全工程與架構（SEAR）</span></div><div class="mt-6 p-5 rounded-xl bg-white dark:bg-slate-800 shadow-soft border border-slate-200 dark:border-slate-700"><div class="text-sm uppercase tracking-wider text-slate-500 dark:text-slate-400">TL;DR</div><ul class="mt-2 grid gap-2 text-slate-700 dark:text-slate-300"><li>「<button class="keyword"data-key="MIE">記憶體完整性強制執行（<strong>MIE</strong>）</button>」結合 <button class="keyword"data-key="EMTE"><strong>EMTE</strong></button>（增強型記憶體標記）、<button class="keyword"data-key="Allocator"><strong>型別化安全配置器</strong></button>與<button class="keyword"data-key="TagConf"><strong>標記機密性強制</strong></button>，在 iPhone 17 / iPhone Air 上提供<strong>永遠啟用</strong>的記憶體安全。<li>設計原則：<strong>同步檢查</strong>、<strong>預設開啟</strong>、<strong>深度軟硬整合</strong>；效能影響極小。<li>目標：令基於記憶體損壞的傭兵間諜軟體利用鏈變得「昂貴且脆弱」，難以維運。</ul></div></section><section id="intro"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>前言與背景 <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2 align-middle"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed"><button class="keyword"data-key="MIE">記憶體完整性強制執行（Memory Integrity Enforcement, MIE）</button>是一項橫跨五年的、前所未有的設計與工程結晶，它結合了 Apple 晶片硬體的獨特優勢與我們先進的作業系統安全，為我們的裝置提供了業界首創、永遠啟用的記憶體安全保護——且不犧牲我們一流的裝置效能。我們相信，MIE 代表了消費級作業系統歷史上對記憶體安全最重大的升級。<p class="mt-3 leading-relaxed">iPhone 從未遭受過成功的大規模惡意軟體攻擊。我們在現實世界中觀察到的唯一系統級 iOS 攻擊來自傭兵間諜軟體，其複雜程度遠超過一般的網路犯罪活動和消費者惡意軟體。已知的針對 iOS 的傭兵間諜軟體鏈與針對 Windows 和 Android 的攻擊有一個共同點：它們都利用了記憶體安全漏洞。</section><section id="apple-history"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>Apple 的安全路線：從語言到配置器與 PAC <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed">對 Apple 而言，提升記憶體安全是一項廣泛的努力，包括使用安全語言進行開發和大規模部署緩解措施。<ul class="mt-3 space-y-2 leading-relaxed"><li><strong><button class="keyword"data-key="Swift">Swift</button></strong>：我們創建了一種易於使用、記憶體安全的語言，用於新程式碼和有針對性的元件重寫。<li><strong><button class="keyword"data-key="Allocator">安全配置器</button></strong>：在 iOS 15 中，我們推出了核心的安全記憶體配置器 <code>kalloc_type</code>，隨後在 iOS 17 中推出了其使用者層級的對應版本 <code>xzone malloc</code>。這些安全配置器利用類型資訊來組織記憶體，使得利用大多數記憶體損壞漏洞本質上變得困難。<li><strong><button class="keyword"data-key="PAC">指標驗證碼（Pointer Authentication Codes, PAC）</button></strong>：2018 年，我們率先在 A12 仿生晶片中部署了 PAC，以保護在記憶體損壞情況下的程式碼流程完整性。</ul></section><section id="mte-to-mie"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>從 MTE 到 EMTE，再到 MIE <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed">Arm 於 2019 年發佈了 <button class="keyword"data-key="MTE">記憶體標記擴充（Memory Tagging Extension, MTE）</button> 規範，作為一種幫助硬體發現記憶體損壞錯誤的工具。我們進行了深入的評估，並與 Arm 合作解決了其弱點，於 2022 年推出了新的 <button class="keyword"data-key="EMTE">增強型記憶體標記擴充（Enhanced Memory Tagging Extension, EMTE）</button> 規範。我們認為記憶體安全保護需要嚴格同步、預設開啟且持續運作。<button class="keyword"data-key="MIE">MIE</button> 以 <button class="keyword"data-key="EMTE">EMTE</button> 的同步模式為核心，並結合我們既有的安全記憶體配置器及廣泛的 <button class="keyword"data-key="TagConf">標記機密性強制（Tag Confidentiality Enforcement）</button> 策略，將 MTE 從一個有用的除錯工具轉變為一項開創性的新安全功能。</section><section id="defenses"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>防禦設計：配置器 × EMTE × 標記機密性 <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed"><button class="keyword"data-key="MIE">MIE</button> 從我們的安全記憶體配置器開始，這些配置器利用類型資訊來決定如何組織記憶體配置。然而，分頁級別的保護對於防禦同一類型儲存區內的攻擊來說過於粗糙，我們使用記憶體標記來彌補這一差距。<h3 class="mt-6 text-lg font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>緩衝區溢位（Buffer Overflow）</h3><p class="mt-2 leading-relaxed">對於緩衝區溢位，配置器負責為相鄰的配置使用不同的標記。如果對記憶體的存取溢出到具有不同標記的相鄰記憶體，硬體會阻止它，作業系統可以採取行動並終止該行程。<div class="mt-3 grid grid-cols-3 gap-2 text-center text-sm"><div class="p-3 rounded-lg border bg-slate-50 dark:bg-slate-800/60">⏺️ Block A<br><span class="text-xs text-slate-500">Tag A</span></div><div class="p-3 rounded-lg border bg-slate-50 dark:bg-slate-800/60">🔼 Block B<br><span class="text-xs text-slate-500">Tag B</span></div><div class="p-3 rounded-lg border bg-slate-50 dark:bg-slate-800/60">⏹️ Block C<br><span class="text-xs text-slate-500">Tag C</span></div></div><p class="mt-2 text-sm text-slate-600 dark:text-slate-400">嘗試以 🔼 標記溢出至 ⏹️ 時將遭阻擋。<h3 class="mt-6 text-lg font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>釋放後使用（Use-after-Free）</h3><p class="mt-2 leading-relaxed">配置器也負責在記憶體被重用於其他目的時重新標記。如果在釋放和重新配置後，仍以較舊的標記對重新標記的記憶體發出請求（如在釋放後使用漏洞利用中所見），硬體會阻止它，並讓作業系統採取進一步行動。<h3 class="mt-6 text-lg font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>未標記區域與 EMTE 改良</h3><p class="mt-2 leading-relaxed">原始 MTE 規範的一個關鍵弱點是，對未標記記憶體（如全域變數）的存取未經硬體檢查。透過 <button class="keyword"data-key="EMTE">EMTE</button>，我們明確要求從已標記的記憶體區域存取未標記的記憶體需要知道該區域的標記，這使得攻擊者更難將動態標記記憶體中的越界錯誤轉化為直接修改未標記配置來規避 EMTE 的方式。<h3 class="mt-6 text-lg font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>標記機密性強制（Tag Confidentiality）</h3><p class="mt-2 leading-relaxed">我們開發了<button class="keyword"data-key="TagConf">標記機密性強制</button>來保護 EMTE 標記的機密性——包括對抗旁路通道和推測執行攻擊。<ul class="mt-2 space-y-2 leading-relaxed"><li><strong>核心與標記儲存防護</strong>：為了保護核心配置器後備儲存和標記儲存，我們使用安全分頁表監視器（Secure Page Table Monitor），即使在核心受損的情況下也能提供強有力的保證。<li><strong>推測執行緩解</strong>：我們從一開始就設計了 Apple 晶片的實現，使得標記值不會以任何方式影響推測執行。最近的研究（StickyTags, TikTag）表明，Google Pixel 設備上的 MTE 實現容易受到此類攻擊。<li><strong>標記不可預測</strong>：我們透過頻繁地重新植入用於選擇新標記的底層偽隨機生成器來解決此問題。<li><strong>Spectre Variant 1 (V1) 限縮</strong>：我們設計了一種緩解措施，以幾乎為零的 CPU 成本限制了 V1 洩漏的有效範圍。這使得攻擊者通常需要 25 個或更多的 V1 序列才能達到超過 95% 的利用成功率。</ul></section><section id="deployment"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>部署與效能：精準啟用 EMTE，維持體驗 <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed">為了支援 <button class="keyword"data-key="MIE">MIE</button>，新的 A19 和 A19 Pro 晶片投入了前所未有的 Apple 晶片資源於安全性上。由於 <button class="keyword"data-key="EMTE">EMTE</button> 標記檢查會帶來效能成本，我們設計 <button class="keyword"data-key="MIE">MIE</button> 首先利用我們的安全配置器，並僅在同一類型儲存區內保護較小的單個配置（軟體配置器無法單獨防禦之處）時使用 <button class="keyword"data-key="EMTE">EMTE</button>。這種對 <button class="keyword"data-key="EMTE">EMTE</button> 的精準部署，使得我們能夠在核心和超過 70 個使用者層級行程中維持同步標記檢查，同時對效能的影響極小。<p class="mt-3 leading-relaxed">自 <button class="keyword"data-key="MIE">MIE</button> 推出之日起，任何開發者都可以立即開始在支援硬體上使用 Xcode 中的「增強安全性」設定為其應用程式測試這項強大的保護，包括 <button class="keyword"data-key="EMTE">EMTE</button>。</section><section id="eval"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>安全評估：讓利用鏈昂貴且脆弱 <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed">在 2020 年至 2025 年期間，我們的攻擊研究團隊持續分析和攻擊該系統——首先是概念性的，然後是在模擬環境中進行實際攻擊，最終在新硬體原型上進行。兩種方法都揭示了相同的結論：<button class="keyword"data-key="MIE">MIE</button> 大大減少了攻擊者可用的利用策略。儘管我們付出了巨大努力，仍無法重建任何這些鏈來繞過 <button class="keyword"data-key="MIE">MIE</button>。剩下的少數記憶體損壞效應是不可靠的，並且沒有給予攻擊者足夠的動力來成功利用這些錯誤。<div class="mt-4 p-4 rounded-lg bg-slate-100/70 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700"><div class="text-sm font-semibold mb-1">攻擊者視角</div><ul class="list-disc ms-5 space-y-1 text-sm leading-6"><li>攻擊者在利用過程的早期就面臨 <button class="keyword"data-key="MIE">MIE</button>。在他們的能力仍然非常有限的階段，就必須面對 MIE，這使得可行的利用途徑很少。<li>這導致了脆弱的鏈，其中破壞一個步驟通常就足以使整個利用策略失效。當這種情況發生時，鏈的大部分組件無法重複使用，攻擊者必須用全新的錯誤重新開始開發。</ul></div></section><section id="conclusion"class="mt-10"><h2 class="group text-2xl font-semibold text-slate-900 dark:text-white anchor-offset"data-toc>結論 <button class="copy-link opacity-0 group-hover:opacity-100 transition text-brand-600 ms-2"title="複製本段連結">#</button></h2><p class="mt-3 leading-relaxed">隨著 iPhone 17 系列和 iPhone Air 的推出，我們很高興能提供 <button class="keyword"data-key="MIE">MIE</button>：業界首個全面、永遠啟用的記憶體安全保護，涵蓋了包括核心和超過 70 個使用者層級行程在內的關鍵攻擊面。根據我們對抗過去三年來異常複雜的傭兵間諜軟體攻擊的評估，我們相信 <button class="keyword"data-key="MIE">MIE</button> 將使漏洞利用鏈的開發和維護成本顯著提高，顛覆過去 25 年來許多最有效的利用技術，並完全重新定義 Apple 產品的記憶體安全格局。</section><button id="backToTop"class="fixed bottom-6 right-6 hidden items-center gap-2 rounded-full px-4 py-2 bg-brand-600 text-white shadow-lg hover:bg-brand-700 transition"aria-label="返回頂部">↑ 返回頂部</button></article></div></main><footer class="border-t border-slate-200 dark:border-slate-700"><div class="mx-auto max-w-7xl px-4 py-10 text-center text-sm"><p class="text-slate-600 dark:text-slate-300"><a href="https://wellstsai.com"target="_blank"rel="noopener"class="font-medium text-brand-600 hover:text-brand-700 dark:text-brand-400 dark:hover:text-brand-300 transition">Generated by wellstsai.com</a><p class="mt-2 text-slate-500 dark:text-slate-400">撰寫日期：2025 年 9 月 11 日</div></footer><div id="keywordModalRoot"class="fixed inset-0 z-[60] hidden"role="dialog"aria-modal="true"aria-labelledby="modalTitle"aria-describedby="modalDesc"><div id="modalOverlay"class="absolute inset-0 bg-slate-900/30 dark:bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0"></div><div class="absolute inset-0 flex items-center justify-center p-4"><div id="modalWrap"class="p-[1px] rounded-2xl bg-gradient-to-br from-brand-400 to-cyan-400 shadow-2xl transition-all duration-300 ease-out opacity-0 scale-95 transform"><div class="w-full max-w-lg rounded-[15px] bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border border-white/20 dark:border-slate-700/50"><div class="p-6"><div class="flex items-start justify-between gap-4"><div><h2 id="modalTitle"class="text-lg font-semibold text-slate-900 dark:text-white"></h2><p id="modalDesc"class="mt-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300"></div><button id="modalClose"class="shrink-0 rounded-full h-8 w-8 flex items-center justify-center text-slate-500 hover:bg-slate-400/20 dark:hover:bg-slate-500/20 hover:text-slate-800 dark:text-slate-400 dark:hover:text-white transition"aria-label="關閉"><svg class="h-5 w-5"viewBox="0 0 20 20"fill="currentColor"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"/></svg></button></div></div></div></div></div></div><script>const htmlEl=document.documentElement,themeToggle=document.getElementById("themeToggle"),iconSun=document.getElementById("iconSun"),iconMoon=document.getElementById("iconMoon");function applyThemeIcon(){const e=htmlEl.classList.contains("dark");iconSun.style.display=e?"block":"none",iconMoon.style.display=e?"none":"block"}!function(){const e=localStorage.getItem("theme");("dark"===e||null===e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&htmlEl.classList.add("dark"),applyThemeIcon()}(),themeToggle.addEventListener("click",()=>{htmlEl.classList.toggle("dark"),localStorage.setItem("theme",htmlEl.classList.contains("dark")?"dark":"light"),applyThemeIcon()});const progressBar=document.getElementById("progressBar");function updateProgress(){const e=document.documentElement,t=e.scrollHeight-e.clientHeight,o=(e.scrollTop||document.body.scrollTop)/(t||1)*100;progressBar.style.setProperty("--scroll",o+"%")}document.addEventListener("scroll",updateProgress,{passive:!0}),updateProgress();const article=document.getElementById("article"),toc=document.getElementById("toc"),headings=[...article.querySelectorAll("[data-toc]")],tocItems=[];headings.forEach(e=>{e.id||(e.id=e.textContent.trim().replace(/\s+/g,"-").replace(/[^\w\-一-龥]/g,""));const t=document.createElement("a");t.href="#"+e.id,t.textContent=e.textContent.trim(),t.className="toc-link block px-2 py-1 rounded hover:bg-slate-100 dark:hover:bg-slate-800",t.setAttribute("data-target",e.id),toc.appendChild(t),tocItems.push(t)});const io=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.id;tocItems.forEach(e=>e.setAttribute("aria-current",e.getAttribute("data-target")===t?"true":"false"))}})},{rootMargin:"0px 0px -70% 0px",threshold:0});function bindCopyButtons(){document.querySelectorAll(".copy-link").forEach(e=>{e.addEventListener("click",t=>{const o=t.currentTarget.closest("[data-toc]"),n=location.origin+location.pathname+"#"+o.id;navigator.clipboard.writeText(n).then(()=>{e.textContent="已複製",setTimeout(()=>e.textContent="#",1200)})})})}headings.forEach(e=>io.observe(e)),bindCopyButtons();const backToTop=document.getElementById("backToTop");function toggleBackToTop(){const e=window.scrollY||document.documentElement.scrollTop;backToTop.classList.toggle("hidden",e<600)}backToTop.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})),document.addEventListener("scroll",toggleBackToTop,{passive:!0}),toggleBackToTop();const searchInput=document.getElementById("searchInput"),clearBtn=document.getElementById("clearSearch"),contentRoot=document.getElementById("article");function clearHighlights(e=contentRoot){e.querySelectorAll("mark.search-hit").forEach(e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()})}function highlight(e){if(!e)return;const t=document.createTreeWalker(contentRoot,NodeFilter.SHOW_TEXT,{acceptNode(t){const o=t.nodeValue;return o&&o.trim()?o.toLowerCase().includes(e.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}}),o=[];for(;t.nextNode();)o.push(t.currentNode);o.forEach(t=>{const o=document.createDocumentFragment();t.nodeValue.split(new RegExp(`(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).forEach(t=>{if(t.toLowerCase()===e.toLowerCase()){const e=document.createElement("mark");e.className="search-hit",e.textContent=t,o.appendChild(e)}else o.appendChild(document.createTextNode(t))}),t.parentNode.replaceChild(o,t)})}function firstHitScroll(){const e=contentRoot.querySelector("mark.search-hit");e&&e.scrollIntoView({block:"center",behavior:"smooth"})}searchInput&&(searchInput.addEventListener("keydown",e=>{"Enter"===e.key&&(clearHighlights(),searchInput.value.trim()&&(highlight(searchInput.value.trim()),firstHitScroll()))}),clearBtn.addEventListener("click",()=>{searchInput.value="",clearHighlights()}));const keywordMap={MIE:{title:"MIE（Memory Integrity Enforcement）",desc:"無官方命名；常被用來概括 Apple 將 MTE、型別化配置器與標記保密機制整合的整體方針，屬推測性名稱。"},EMTE:{title:"EMTE（Enhanced Memory Tagging Extension）",desc:"Arm 並未發表 “EMTE”；據傳 Apple SoC 透過 MTE 的同步檢查與未標記頁面強制 fault 等方式加強防護，但此稱呼未被標準化。"},MTE:{title:"MTE（Memory Tagging Extension）",desc:"Armv8.5-A 的硬體功能，利用 4-bit 標記偵測野指標、UAF 與越界存取，支援同步與非同步錯誤回報。"},PAC:{title:"PAC（Pointer Authentication Codes）",desc:"來自 Armv8.3-A 的指標驗證機制，用於保護控制流程完整性；Apple 自 2018 年 A12 Bionic 起導入。"},Allocator:{title:"型別化安全配置器",desc:"kalloc_type 與 libpas 皆屬「型別感知」配置器，可將記憶體區塊依型別隔離並驗證大小，降低 UAF 與越界利用風險。"},TagConf:{title:"標記機密性保護",desc:"無正式 “TagConf” 規格；Apple 的 Secure Page Table Monitor 與側通道緩解措施可減少標記值外洩，但並非獨立命名功能。"},Swift:{title:"Swift",desc:"Apple 於 2014 推出的記憶體安全程式語言，透過 ARC、型別安全與選項語法降低 C/C++ 常見漏洞。"}},modalRoot=document.getElementById("keywordModalRoot"),modalOverlay=document.getElementById("modalOverlay"),modalWrap=document.getElementById("modalWrap"),modalClose=document.getElementById("modalClose"),modalTitle=document.getElementById("modalTitle"),modalDesc=document.getElementById("modalDesc"),mainElements=[document.querySelector("header"),document.querySelector("main"),document.querySelector("footer")];let lastActiveElement=null;function openModal(e){const t=keywordMap[e];t&&(lastActiveElement=document.activeElement,modalTitle.textContent=t.title,modalDesc.textContent=t.desc,modalRoot.classList.remove("hidden"),document.body.style.overflow="hidden",requestAnimationFrame(()=>{modalOverlay.classList.remove("opacity-0"),modalWrap.classList.remove("opacity-0","scale-95")}),mainElements.forEach(e=>e&&(e.inert=!0)),modalClose.focus())}function closeModal(){modalOverlay.classList.add("opacity-0"),modalWrap.classList.add("opacity-0","scale-95"),setTimeout(()=>{modalRoot.classList.add("hidden"),document.body.style.overflow="",mainElements.forEach(e=>e&&(e.inert=!1)),lastActiveElement&&lastActiveElement.focus()},300)}document.addEventListener("click",e=>{const t=e.target.closest(".keyword");t&&openModal(t.dataset.key)}),modalClose.addEventListener("click",closeModal),modalOverlay.addEventListener("click",closeModal),window.addEventListener("keydown",e=>{"Escape"!==e.key||modalRoot.classList.contains("hidden")||closeModal()})</script>