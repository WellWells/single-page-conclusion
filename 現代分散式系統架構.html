<!doctypehtml><html lang="zh-TW"class="scroll-smooth"><meta name="twitter:image"content="https://wellstsai.com/single-page-conclusion/%E7%8F%BE%E4%BB%A3%E5%88%86%E6%95%A3%E5%BC%8F%E7%B3%BB%E7%B5%B1%E6%9E%B6%E6%A7%8B.png"><meta name="twitter:description"content="實務視角解析分散式系統五大核心：鍵值儲存、一致性雜湊、CAP 定理、向量時鐘與 Gossip 協定。從資料分片、動態擴展到一致性-可用性權衡與因果追蹤，並延伸至現代去中心化架構與協定設計。點擊卡片，立即掌握設計原理、效能 trade-offs 與實作要點。"><meta name="twitter:title"content="現代分散式系統架構"><meta name="twitter:card"content="summary_large_image"><meta property="og:type"content="article"><meta property="og:site_name"content="WellWells"><meta property="og:image"content="https://wellstsai.com/single-page-conclusion/%E7%8F%BE%E4%BB%A3%E5%88%86%E6%95%A3%E5%BC%8F%E7%B3%BB%E7%B5%B1%E6%9E%B6%E6%A7%8B.png"><meta property="og:url"content="https://wellstsai.com/single-page-conclusion/%E7%8F%BE%E4%BB%A3%E5%88%86%E6%95%A3%E5%BC%8F%E7%B3%BB%E7%B5%B1%E6%9E%B6%E6%A7%8B.html"><meta property="og:description"content="實務視角解析分散式系統五大核心：鍵值儲存、一致性雜湊、CAP 定理、向量時鐘與 Gossip 協定。從資料分片、動態擴展到一致性-可用性權衡與因果追蹤，並延伸至現代去中心化架構與協定設計。點擊卡片，立即掌握設計原理、效能 trade-offs 與實作要點。"><meta property="og:title"content="現代分散式系統架構"><meta name="description"content="實務視角解析分散式系統五大核心：鍵值儲存、一致性雜湊、CAP 定理、向量時鐘與 Gossip 協定。從資料分片、動態擴展到一致性-可用性權衡與因果追蹤，並延伸至現代去中心化架構與協定設計。點擊卡片，立即掌握設計原理、效能 trade-offs 與實作要點。"><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1"><title>現代分散式系統架構</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"rel="stylesheet"><style>@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes scaleUp{from{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}body{font-family:'Noto Sans TC',sans-serif;background-color:#f8fafc;color:#4a4a4a}.section-hidden{opacity:0;transform:translateY(20px)}.section-visible{animation:fadeIn .8s ease-out forwards}.glassmorphism{background:rgba(255,255,255,.2);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.3);box-shadow:0 4px 6px rgba(0,0,0,.1),0 1px 3px rgba(0,0,0,.08)}.gradient-text{background:linear-gradient(90deg,#60a5fa,#c084fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.btn{transition:all .3s ease}.btn-primary{background-color:#60a5fa;color:#fff}.btn-primary:hover{background-color:#3b82f6;transform:translateY(-2px)}.btn-secondary{background-color:#e5e7eb;color:#4b5563}.btn-secondary:hover{background-color:#d1d5db;transform:translateY(-2px)}.chart-container{position:relative;width:100%;max-width:800px;margin-left:auto;margin-right:auto;height:300px;max-height:400px}@media (min-width:768px){.chart-container{height:400px;max-height:500px}}.table-highlight tr:hover td{background-color:#e0e7ff}.cap-choice{cursor:pointer;transition:all .3s ease;border:2px solid transparent}.cap-choice.selected{border-color:#60a5fa;background-color:#eff6ff;transform:scale(1.02);animation:pulse 1s infinite}.cap-choice.dimmed{opacity:.5;filter:grayscale(80%);transform:scale(1);animation:none}.keyword-link{text-decoration:none;cursor:pointer;font-weight:500;color:#1d4ed8;transition:all .3s ease}.keyword-link:hover{color:#3b82f6;background-color:#dbeafe;padding:2px 4px;border-radius:4px}.modal{background-color:rgba(0,0,0,.5);backdrop-filter:blur(5px);transition:all .3s ease-out;opacity:0;visibility:hidden}.modal.show{opacity:1;visibility:visible}.modal-content{animation:scaleUp .3s ease-out}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-JKC4KZLT26"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JKC4KZLT26")</script><body class="antialiased"><header id="navbar"class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm transition-opacity duration-300 opacity-0 -translate-y-full"><nav class="container mx-auto px-6 py-3 flex justify-between items-center"><a href="#hero"class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-violet-500">分散式系統核心</a><div class="hidden md:flex space-x-8"><a href="#kvs"class="nav-link border-b-2 border-transparent pb-1">鍵值儲存</a> <a href="#consistent-hashing"class="nav-link border-b-2 border-transparent pb-1">一致性雜湊</a> <a href="#cap-theorem"class="nav-link border-b-2 border-transparent pb-1">CAP 定理</a> <a href="#vector-clocks"class="nav-link border-b-2 border-transparent pb-1">向量時鐘</a> <a href="#gossip-protocol"class="nav-link border-b-2 border-transparent pb-1">Gossip 協定</a></div></nav></header><main><section id="hero"class="container mx-auto px-6 py-20 text-center"><h1 class="text-4xl md:text-6xl font-bold tracking-tight leading-tight gradient-text">現代分散式系統架構</h1><p class="mt-4 text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">從 CAP 定理到去中心化協定的互動式深度解析<p class="mt-8 text-gray-500 max-w-4xl mx-auto">本報告旨在深入剖析構成當代分散式系統基石的五大核心。它們並非孤立的技術，而是一套相互關聯、彼此協作的解決方案。請點擊下方卡片，開始您的探索之旅，深刻理解這些概念的運作原理與其內在的權衡取捨。</section><section class="container mx-auto px-6 py-12"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8"><a href="#kvs"class="concept-card glassmorphism p-8 rounded-2xl shadow-xl text-center"><div class="text-4xl mb-4 bg-gradient-to-r from-blue-400 to-cyan-400 text-white inline-block p-4 rounded-full">🗂️</div><h3 class="text-xl font-bold text-gray-800">鍵值儲存</h3><p class="mt-2 text-gray-500">資料儲存的基石</p></a><a href="#consistent-hashing"class="concept-card glassmorphism p-8 rounded-2xl shadow-xl text-center"><div class="text-4xl mb-4 bg-gradient-to-r from-blue-400 to-cyan-400 text-white inline-block p-4 rounded-full">🔄</div><h3 class="text-xl font-bold text-gray-800">一致性雜湊</h3><p class="mt-2 text-gray-500">動態擴展的藝術</p></a><a href="#cap-theorem"class="concept-card glassmorphism p-8 rounded-2xl shadow-xl text-center"><div class="text-4xl mb-4 bg-gradient-to-r from-blue-400 to-cyan-400 text-white inline-block p-4 rounded-full">⚖️</div><h3 class="text-xl font-bold text-gray-800">CAP 定理</h3><p class="mt-2 text-gray-500">系統的鐵三角</p></a><a href="#vector-clocks"class="concept-card glassmorphism p-8 rounded-2xl shadow-xl text-center"><div class="text-4xl mb-4 bg-gradient-to-r from-blue-400 to-cyan-400 text-white inline-block p-4 rounded-full">🕰️</div><h3 class="text-xl font-bold text-gray-800">向量時鐘</h3><p class="mt-2 text-gray-500">追溯事件因果</p></a><a href="#gossip-protocol"class="concept-card glassmorphism p-8 rounded-2xl shadow-xl text-center"><div class="text-4xl mb-4 bg-gradient-to-r from-blue-400 to-cyan-400 text-white inline-block p-4 rounded-full">🗣️</div><h3 class="text-xl font-bold text-gray-800">Gossip 協定</h3><p class="mt-2 text-gray-500">去中心化智慧</p></a></div></section><div class="space-y-24 md:space-y-32 my-24 md:my-32"><section id="kvs"class="container mx-auto px-6 scroll-mt-20 section-hidden"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold gradient-text">第一章：鍵值儲存 (Key-Value Store)</h2><p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">在探討複雜的分散式系統之前，必須先理解其最基礎的資料儲存模型。<span class="keyword-link"data-modal="kvs">鍵值儲存 (KVS)</span> 作為 <span class="keyword-link"data-modal="nosql">NoSQL</span> 資料庫家族中最簡潔的形式，為現代大規模應用提供了高效能的資料存取基礎。</div><div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center"><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold mb-4 text-gray-800">KVS vs. RDBMS 權衡</h3><p class="text-gray-600 mb-6">KVS 的崛起並非旨在完全取代傳統 RDBMS，而是為了解決不同類型的問題。下表清晰呈現了兩者在設計哲學與架構上的根本差異與權衡取捨。<div class="overflow-x-auto"><table class="w-full text-left border-collapse table-highlight"><thead><tr><th class="py-3 px-4 bg-gray-50 font-bold uppercase text-sm text-gray-600 border-b">特性<th class="py-3 px-4 bg-gray-50 font-bold uppercase text-sm text-gray-600 border-b">鍵值儲存 (KVS)<th class="py-3 px-4 bg-gray-50 font-bold uppercase text-sm text-gray-600 border-b">關聯式資料庫 (RDBMS)<tbody><tr class="hover:bg-blue-50"><td class="py-3 px-4 border-b font-semibold">資料模型<td class="py-3 px-4 border-b">鍵與值的成對集合<td class="py-3 px-4 border-b">具有行與列的資料表<tr class="hover:bg-blue-50"><td class="py-3 px-4 border-b font-semibold">綱要 (Schema)<td class="py-3 px-4 border-b">無綱要、彈性<td class="py-3 px-4 border-b">預先定義、嚴格<tr class="hover:bg-blue-50"><td class="py-3 px-4 border-b font-semibold">擴展性<td class="py-3 px-4 border-b">水平擴展 (Scale-out)<td class="py-3 px-4 border-b">垂直擴展 (Scale-up)<tr class="hover:bg-blue-50"><td class="py-3 px-4 border-b font-semibold">一致性模型<td class="py-3 px-4 border-b">通常為最終一致性<td class="py-3 px-4 border-b">通常為強一致性</table></div></div><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold mb-4 text-gray-800">典型應用場景</h3><p class="text-gray-600 mb-6">基於低延遲、高吞吐量與水平擴展性的優勢，KVS 在多個領域得到了廣泛應用。點擊下方頁籤查看不同場景的說明。<div id="kvs-tabs"><div class="border-b border-gray-200"><nav class="-mb-px flex space-x-8"aria-label="Tabs"><button class="kvs-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-500"data-target="caching">快取</button> <button class="kvs-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 border-transparent"data-target="session">會話管理</button> <button class="kvs-tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 border-transparent"data-target="bigdata">即時分析</button></nav></div><div id="kvs-tab-content"class="pt-6"><div id="caching-content"class="kvs-content">將頻繁存取的資料從較慢的主資料庫 (如 RDBMS) 暫存於 KVS 中，以大幅提升應用程式的回應速度。Redis 和 Memcached 是此領域的代表性產品。</div><div id="session-content"class="kvs-content hidden">儲存網站使用者的會話資訊，如登入狀態、購物車內容等。這類資料需要快速的讀寫，且通常有時效性，非常適合 KVS。</div><div id="bigdata-content"class="kvs-content hidden">作為大量非結構化或半結構化資料的儲存引擎，例如使用者行為日誌、物聯網 (IoT) 感測器數據等。KVS 的高速寫入能力使其能勝任海量資料的即時擷取與儲存。</div></div></div></div></div></section><section id="consistent-hashing"class="container mx-auto px-6 scroll-mt-20 section-hidden"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold gradient-text">第二章：一致性雜湊</h2><p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">當資料量超過單一伺服器負載時，需將資料分散儲存。<span class="keyword-link"data-modal="consistent-hashing">一致性雜湊</span>演算法提供了在動態增減節點時，能以最小代價重新分佈資料的能力，是實現系統彈性的基石。</div><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold text-center mb-4 text-gray-800">互動式雜湊環</h3><p class="text-gray-600 text-center max-w-2xl mx-auto mb-6">傳統雜湊取模在節點變動時會導致災難性的資料遷移。一致性雜湊透過環狀結構，將影響局部化。請使用下方按鈕，觀察新增或移除節點時，資料（灰色點）遷移的變化。<div class="chart-container h-96 md:h-[500px]"><canvas id="consistentHashingCanvas"></canvas></div><div class="flex justify-center space-x-4 mt-6"><button id="addNodeBtn"class="btn btn-primary px-6 py-2 rounded-lg font-semibold">新增節點</button> <button id="removeNodeBtn"class="btn btn-secondary px-6 py-2 rounded-lg font-semibold">移除節點</button> <button id="resetBtn"class="btn btn-secondary px-6 py-2 rounded-lg font-semibold">重設</button></div><div class="mt-4 text-center text-sm text-gray-500">藍色大點代表伺服器節點，灰色小點代表資料鍵。虛線表示受影響的資料遷移。</div></div></section><section id="cap-theorem"class="container mx-auto px-6 scroll-mt-20 section-hidden"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold gradient-text">第三章：CAP 定理</h2><p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto"><span class="keyword-link"data-modal="cap-theorem">CAP 定理</span>是分散式運算最重要的理論基石。它指出任何分散式系統最多只能同時滿足一致性 (C)、可用性 (A) 與分割區容錯性 (P) 這三項保證中的兩項。</div><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold text-center mb-4 text-gray-800">權衡的抉擇</h3><p class="text-gray-600 text-center max-w-2xl mx-auto mb-8">在分散式系統中，網路分割區 (P) 是無法避免的。因此，當分割區發生時，您必須在一致性 (C) 與可用性 (A) 之間做出抉擇。請切換下方的「網路分割區」開關，並選擇您的系統設計策略。<div class="flex items-center justify-center space-x-4 mb-8"><span class="font-medium text-gray-700">網路正常</span> <label for="partitionToggle"class="relative inline-flex items-center cursor-pointer"><input type="checkbox"id="partitionToggle"class="sr-only peer"><div class="w-14 h-8 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-red-500"></div></label> <span class="font-medium text-red-500">發生網路分割區!</span></div><div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto"><div id="cp-choice"class="cap-choice p-6 rounded-lg border-2 border-gray-200"><h4 class="text-xl font-bold text-center text-gray-800">CP 系統</h4><p class="mt-2 text-gray-600">若無法保證資料最新，則回傳錯誤或逾時。適合金融交易、訂單處理等不容許資料錯誤的場景。</div><div id="ap-choice"class="cap-choice p-6 rounded-lg border-2 border-gray-200"><h4 class="text-xl font-bold text-center text-gray-800">AP 系統</h4><p class="mt-2 text-gray-600">回傳當前節點可存取的最新版本資料，可能為過期資料。適合社群媒體、內容分發等高可用性優先的場景。</div></div><p id="cap-result"class="mt-8 text-center font-semibold text-lg text-blue-700 h-8"></div></section><section id="vector-clocks"class="container mx-auto px-6 scroll-mt-20 section-hidden"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold gradient-text">第四章：向量時鐘</h2><p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">在沒有中央時鐘的系統中，確定事件的因果順序極具挑戰。<span class="keyword-link"data-modal="vector-clocks">向量時鐘</span>提供了一種邏輯機制，用於追蹤事件間的因果關係，並偵測資料衝突。</div><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold text-center mb-4 text-gray-800">因果關係模擬器</h3><p class="text-gray-600 text-center max-w-2xl mx-auto mb-8">向量時鐘是一個 `[節點A計數, 節點B計數]` 陣列。請按步驟執行操作，觀察向量時鐘如何記錄事件歷史並偵測並行衝突。<div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start"><div class="md:col-span-1"><h4 class="font-bold text-lg mb-4 text-center text-gray-800">操作面板</h4><div class="space-y-3"id="vc-controls"><button data-op="reset"class="w-full btn btn-secondary py-2 rounded-md">1. 重設狀態</button> <button data-op="updateA"class="w-full btn btn-secondary py-2 rounded-md">2. 節點A 本地更新</button> <button data-op="updateB"class="w-full btn btn-secondary py-2 rounded-md">3. 節點B 本地更新 (製造衝突)</button> <button data-op="sendBtoA"class="w-full btn btn-secondary py-2 rounded-md">4. 節點B 將資料傳送給A</button> <button data-op="mergeA"class="w-full btn btn-secondary py-2 rounded-md">5. 節點A 合併資料</button></div></div><div class="md:col-span-2 grid grid-cols-2 gap-4 text-center"><div><h4 class="font-bold text-lg mb-2 text-gray-800">節點 A</h4><div class="bg-blue-200/50 p-4 rounded-lg"><p class="font-mono text-xl text-blue-800"id="vc-node-a">[0, 0]</div><div id="vc-log-a"class="mt-2 text-sm text-left space-y-1"></div></div><div><h4 class="font-bold text-lg mb-2 text-gray-800">節點 B</h4><div class="bg-violet-200/50 p-4 rounded-lg"><p class="font-mono text-xl text-violet-800"id="vc-node-b">[0, 0]</div><div id="vc-log-b"class="mt-2 text-sm text-left space-y-1"></div></div></div></div><div id="vc-status"class="mt-6 text-center font-semibold text-lg text-blue-700 h-8"></div></div></section><section id="gossip-protocol"class="container mx-auto px-6 scroll-mt-20 section-hidden"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold gradient-text">第五章：Gossip 協定</h2><p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto"><span class="keyword-link"data-modal="gossip-protocol">Gossip 協定</span>（或稱流行病協定）模仿謠言的傳播方式，提供了一種去中心化、高擴展性且容錯的解決方案，用於在大型叢集中傳播狀態資訊與偵測故障。</div><div class="grid grid-cols-1 lg:grid-cols-2 gap-12"><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold text-center mb-4 text-gray-800">擴展性比較：網路負載</h3><p class="text-gray-600 text-center mb-6">Gossip 的網路負載約為 O(N log N)，而傳統的直接監控為 O(N²)。此圖表顯示隨著節點數量增加，Gossip 在擴展性上的巨大優勢。<div class="chart-container h-80"><canvas id="gossipScalabilityChart"></canvas></div></div><div class="glassmorphism p-8 rounded-xl shadow-lg"><h3 class="text-2xl font-bold text-center mb-4 text-gray-800">資訊傳播模擬</h3><p class="text-gray-600 text-center mb-6">點擊「開始傳播」，觀察一個新資訊（藍色節點）如何透過隨機的點對點「閒聊」快速地擴散至整個叢集。<div class="chart-container h-80 bg-gray-50 rounded-lg"><canvas id="gossipSpreadCanvas"></canvas></div><div class="flex justify-center mt-4"><button id="startGossipBtn"class="btn btn-primary px-6 py-2 rounded-lg font-semibold">開始傳播</button></div></div></div></section></div></main><footer class="bg-slate-900 text-gray-300"><div class="container mx-auto px-6 py-8 text-center text-sm md:text-base"><a href="https://wellstsai.com"target="_blank"class="text-blue-400 hover:underline mt-1 inline-block transition-colors duration-200">Generated by wellstsai.com</a></div></footer><div id="info-modal"class="fixed inset-0 z-[100] flex items-center justify-center p-4 modal"><div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md modal-content transform transition-transform duration-300"><div class="flex justify-between items-center mb-4"><h4 id="modal-title"class="text-xl font-bold text-gray-800"></h4><button id="close-modal"class="text-gray-500 hover:text-gray-800 text-2xl font-bold p-1 leading-none transition-transform duration-200 transform hover:rotate-90">&times;</button></div><p id="modal-body"class="text-gray-600"></div></div><script>document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("info-modal"),t=document.getElementById("modal-title"),n=document.getElementById("modal-body"),o=document.getElementById("close-modal"),a={kvs:{title:"鍵值儲存 (KVS)",body:"這是一種極簡化的資料儲存模型，其核心思想是將一個唯一的「鍵」對應到一個不透明的「值」。這種模型天然具備無綱要（Schemaless）的特性，並針對高速讀寫進行了高度優化。"},nosql:{title:"NoSQL 資料庫",body:"意指「不僅僅是 SQL」。這類資料庫旨在解決傳統關係型資料庫在處理大規模、非結構化資料和高並行負載時所面臨的挑戰。KVS、文件資料庫、圖形資料庫和寬列資料庫都屬於 NoSQL 家族。"},"consistent-hashing":{title:"一致性雜湊",body:"這是一種分散式雜湊技術，能確保當叢集中的伺服器數量變動時，只有一小部分資料需要被重新分佈。這極大地減少了資料遷移的成本，是實現系統彈性擴展的關鍵。"},"cap-theorem":{title:"CAP 定理",body:"分散式系統的經典理論。它指出一個系統最多只能同時滿足一致性（Consistency）、可用性（Availability）和分割區容錯性（Partition Tolerance）三者中的兩項。在現實世界中，由於網路分割區不可避免，設計者必須在一致性與可用性之間做出權衡。"},"vector-clocks":{title:"向量時鐘",body:"一種用於追蹤分散式系統中事件因果關係的邏輯時鐘機制。由於節點間的物理時鐘可能不同步，向量時鐘能夠提供一個可靠的方式來判斷兩個事件是按序發生，還是同時發生（衝突），是實現最終一致性的關鍵工具。"},"gossip-protocol":{title:"Gossip 協定",body:"一種去中心化的通訊協定，模仿謠言在人群中的傳播方式。節點會週期性地隨機與其他節點交換狀態資訊。這種方式確保資訊最終能可靠地傳播到整個網路，並能有效地偵測節點故障，是高容錯系統的基石。"}},s=()=>{e.classList.remove("show")};document.querySelectorAll(".keyword-link").forEach(o=>{o.addEventListener("click",s=>{s.preventDefault();const i=o.dataset.modal;var l;a[i]&&(l=a[i],t.textContent=l.title,n.textContent=l.body,e.classList.add("show"))})}),o.addEventListener("click",s),e.addEventListener("click",t=>{t.target===e&&s()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&e.classList.contains("show")&&s()});(()=>{const e=document.querySelectorAll(".kvs-tab-btn"),t=document.querySelectorAll(".kvs-content");e.forEach(n=>{n.addEventListener("click",()=>{const o=n.dataset.target;e.forEach(e=>{e.classList.remove("text-blue-600","border-blue-500"),e.classList.add("text-gray-500","hover:text-gray-700","hover:border-gray-300","border-transparent")}),n.classList.add("text-blue-600","border-blue-500"),n.classList.remove("text-gray-500","hover:text-gray-700","hover:border-gray-300","border-transparent"),t.forEach(e=>{e.id===`${o}-content`?e.classList.remove("hidden"):e.classList.add("hidden")})})})})(),(()=>{const e=document.getElementById("consistentHashingCanvas"),t=e.getContext("2d");let n=[];const o=[];const a=e=>{if(0===n.length)return null;for(const t of n)if(e<=t.angle)return t;return n[0]},s=()=>{n=[],o.length=0;for(let e=0;e<3;e++)n.push({id:`S${e}`,angle:2*Math.random()*Math.PI,color:"#1D4ED8"});for(let e=0;e<100;e++)o.push({id:`K${e}`,angle:2*Math.random()*Math.PI,color:"#6B7280"});n.sort((e,t)=>e.angle-t.angle),o.forEach(e=>e.owner=a(e.angle)),i()},i=(a=[])=>{const{width:s,height:i}=e,l=s/2,r=i/2,c=.4*Math.min(s,i);t.clearRect(0,0,s,i),t.strokeStyle="#D1D5DB",t.lineWidth=2,t.beginPath(),t.arc(l,r,c,0,2*Math.PI),t.stroke(),n.forEach(e=>{const n=l+c*Math.cos(e.angle),o=r+c*Math.sin(e.angle);t.fillStyle=e.color,t.beginPath(),t.arc(n,o,10,0,2*Math.PI),t.fill(),t.fillStyle="#374151",t.fillText(e.id,n+15,o+5)}),o.forEach(e=>{const n=l+c*Math.cos(e.angle),o=r+c*Math.sin(e.angle);t.fillStyle=e.color,t.beginPath(),t.arc(n,o,3,0,2*Math.PI),t.fill()}),a.forEach(e=>{Math.cos(e.from.angle),Math.sin(e.from.angle);const n={x:l+c*Math.cos(e.to.angle),y:r+c*Math.sin(e.to.angle)};t.strokeStyle="#EF4444",t.lineWidth=1.5,t.setLineDash([5,3]),t.beginPath();const o=l+c*Math.cos(e.key.angle),a=r+c*Math.sin(e.key.angle);t.moveTo(o,a),t.lineTo(n.x,n.y),t.stroke(),t.setLineDash([])})};document.getElementById("addNodeBtn").addEventListener("click",()=>{if(n.length>=8)return;const e=new Map(o.map(e=>[e.id,e.owner])),t={id:`S${n.length}`,angle:2*Math.random()*Math.PI,color:"#3B82F6"};n.push(t),n.sort((e,t)=>e.angle-t.angle);const s=[];o.forEach(t=>{const n=a(t.angle);n.id!==e.get(t.id).id&&s.push({key:t,from:e.get(t.id),to:n}),t.owner=n}),i(s),setTimeout(()=>i(),2e3)}),document.getElementById("removeNodeBtn").addEventListener("click",()=>{if(n.length<=1)return;const e=new Map(o.map(e=>[e.id,e.owner]));n.pop();n.sort((e,t)=>e.angle-t.angle);const t=[];o.forEach(n=>{const o=a(n.angle);o.id!==e.get(n.id).id&&t.push({key:n,from:e.get(n.id),to:o}),n.owner=o}),i(t),setTimeout(()=>i(),2e3)}),document.getElementById("resetBtn").addEventListener("click",s),window.addEventListener("resize",()=>{const t=e.parentElement;e.width=t.clientWidth,e.height=t.clientHeight,i()}),s()})(),(()=>{const e=document.getElementById("partitionToggle"),t=document.getElementById("cp-choice"),n=document.getElementById("ap-choice"),o=document.getElementById("cap-result"),a=()=>{const a=e.checked;t.classList.remove("selected","dimmed"),n.classList.remove("selected","dimmed"),o.textContent=a?"網路分割區發生！請在 C 和 A 之間選擇。":"網路正常，系統可同時提供 C 和 A (理論上的 CA 系統)"};e.addEventListener("change",a),t.addEventListener("click",()=>{e.checked&&(t.classList.add("selected"),n.classList.remove("selected"),n.classList.add("dimmed"),o.textContent="您選擇了 CP 系統：優先保證一致性。")}),n.addEventListener("click",()=>{e.checked&&(n.classList.add("selected"),t.classList.remove("selected"),t.classList.add("dimmed"),o.textContent="您選擇了 AP 系統：優先保證可用性。")}),a()})(),(()=>{const e=document.getElementById("vc-node-a"),t=document.getElementById("vc-node-b"),n=document.getElementById("vc-log-a"),o=document.getElementById("vc-log-b"),a=document.getElementById("vc-status"),s=document.getElementById("vc-controls");let i=[0,0],l=[0,0],r=null;const c=()=>{i=[0,0],l=[0,0],r=null,e.textContent=`[${i.join(", ")}]`,t.textContent=`[${l.join(", ")}]`,n.innerHTML="",o.innerHTML="",a.textContent="狀態已重設。"},d=()=>{e.textContent=`[${i.join(", ")}]`,t.textContent=`[${l.join(", ")}]`};s.addEventListener("click",e=>{if("BUTTON"!==e.target.tagName)return;switch(e.target.dataset.op){case"reset":c();break;case"updateA":i[0]++,n.innerHTML+=`<p>本地更新: vA=${JSON.stringify(i)}</p>`,d();break;case"updateB":l[1]++,o.innerHTML+=`<p>本地更新: vB=${JSON.stringify(l)}</p>`,d();break;case"sendBtoA":r=[...l],o.innerHTML+=`<p>傳送資料(vB=${JSON.stringify(r)})給A</p>`,a.textContent="節點 A 已收到來自 B 的資料。";break;case"mergeA":if(!r)return void(a.textContent="請先讓節點 B 傳送資料。");n.innerHTML+=`<p>收到資料(vB=${JSON.stringify(r)})</p>`,s=r,(t=i).every((e,t)=>e<=s[t])||s.every((e,n)=>e<=t[n])?a.textContent="無衝突，可安全合併。":a.textContent=`衝突偵測！vA=${JSON.stringify(i)} 和 vB=${JSON.stringify(r)} 並行發生。`,i[0]=Math.max(i[0],r[0]),i[1]=Math.max(i[1],r[1]),i[0]++,n.innerHTML+=`<p>合併並更新: vA=${JSON.stringify(i)}</p>`,r=null,d()}var t,s}),c()})(),(()=>{const e=document.getElementById("gossipScalabilityChart").getContext("2d"),t=Array.from({length:10},(e,t)=>100*(t+1));new Chart(e,{type:"line",data:{labels:t,datasets:[{label:"直接監控 (O(N²))",data:t.map(e=>e*e),borderColor:"#EF4444",tension:.1},{label:"Gossip (O(N log N))",data:t.map(e=>e*Math.log(e)),borderColor:"#3B82F6",tension:.1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:e=>e.toExponential(1)}},x:{title:{display:!0,text:"節點數量 (N)"}}},plugins:{legend:{position:"top"},title:{display:!0,text:"網路訊息量比較"}}}});const n=document.getElementById("gossipSpreadCanvas"),o=n.getContext("2d"),a=document.getElementById("startGossipBtn"),s=[];let i=null;function l(){const e=n.parentElement;n.width=e.clientWidth,n.height=e.clientHeight,c()}function r(){s.length=0;for(let e=0;e<50;e++)s.push({x:Math.random()*n.width,y:Math.random()*n.height,infected:!1});c()}function c(){const{width:e,height:t}=n;o.clearRect(0,0,e,t),s.forEach(e=>{o.fillStyle=e.infected?"#3B82F6":"#D1D5DB",o.beginPath(),o.arc(e.x,e.y,5,0,2*Math.PI),o.fill()})}a.addEventListener("click",()=>{i&&clearInterval(i),r(),s[Math.floor(50*Math.random())].infected=!0,c(),i=setInterval(()=>{const e=s.filter(e=>e.infected);if(0===e.length||50===e.length)return void clearInterval(i);e[Math.floor(Math.random()*e.length)];s[Math.floor(50*Math.random())].infected=!0,c()},200)}),window.addEventListener("resize",l),l(),r()})(),(()=>{const e=document.getElementById("navbar"),t=document.getElementById("hero"),n=document.querySelectorAll("section[id]"),o=document.querySelectorAll(".nav-link");new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting?e.classList.add("opacity-0","-translate-y-full"):e.classList.remove("opacity-0","-translate-y-full")})},{threshold:.1}).observe(t);const a=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&o.forEach(t=>{t.classList.toggle("active",t.getAttribute("href").substring(1)===e.target.id)})})},{rootMargin:"-50% 0px -50% 0px"});n.forEach(e=>{"hero"!==e.id&&a.observe(e)})})(),(()=>{const e=document.querySelectorAll(".section-hidden"),t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("section-visible"),e.target.classList.remove("section-hidden"),t.unobserve(e.target))})},{threshold:.2});e.forEach(e=>t.observe(e))})()})</script>